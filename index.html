<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Registro de Calificaciones</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
        color: #e0e6ed;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        position: relative;
        overflow-x: hidden;
    }
    body::before {
        content: '';
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background:
            radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 40% 80%, rgba(120, 219, 255, 0.06) 0%, transparent 50%);
        pointer-events: none; z-index: 0;
    }
    .container { position: relative; z-index: 1; width: 100%; max-width: 800px; }
    h1 {
        font-size: 3rem; font-weight: 700;
        background: linear-gradient(135deg, #00d4ff 0%, #ff00ff 50%, #ff4081 100%);
        background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        text-align: center; margin: 40px 0; text-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
    }
    .glass-card {
        background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px;
        padding: 30px; margin: 20px 0; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
    }
    .glass-card:hover { transform: translateY(-5px); box-shadow: 0 30px 60px rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.2); }
    .hidden { display: none !important; }

    .search-section { display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; }
    .search-input { position: relative; }
    .search-input::after {
        content: 'üîç'; position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
        pointer-events: none; opacity: 0.6;
    }
    input, button {
        padding: 15px 20px; font-size: 16px; font-family: 'Inter', sans-serif;
        border: none; border-radius: 12px; transition: all 0.3s ease; font-weight: 500;
    }
    input {
        background: rgba(255, 255, 255, 0.08); color: #e0e6ed; min-width: 200px;
        border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
    }
    input:focus {
        outline: none; background: rgba(255,255,255,0.12); border-color: #00d4ff;
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); transform: scale(1.02);
    }
    input::placeholder { color: rgba(224, 230, 237, 0.6); }
    button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;
        cursor: pointer; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
        position: relative; overflow: hidden;
    }
    button::before {
        content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
    }
    button:hover::before { left: 100%; }
    button:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102,126,234,0.4); }

    .btn-primary { background: linear-gradient(135deg, #00d4ff 0%, #ff00ff 100%); }
    .btn-success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .btn-edit { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333; }
    .btn-delete { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); }
    .btn-ghost {
        background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12);
        text-transform: none; letter-spacing: 0;
    }

    .form-grid { display: grid; grid-template-columns: 1fr; gap: 20px; margin: 20px 0; }
    .form-row { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
    .form-row input { flex: 1; min-width: 150px; }

    .calificaciones-container {
        display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px; margin: 20px 0; padding: 20px;
        background: rgba(255,255,255,0.03); border-radius: 15px; border: 1px solid rgba(255,255,255,0.05);
    }
    .nota-item {
        display: flex; gap: 8px; align-items: center; justify-content: center;
        background: rgba(0, 212, 255, 0.08); padding: 8px; border-radius: 12px;
        border: 1px solid rgba(0, 212, 255, 0.15);
    }
    .nota-item input {
        text-align: center; font-weight: 600; flex: 1; min-width: 0;
        background: transparent; border: 1px solid rgba(0, 212, 255, 0.2);
    }
    .nota-item button {
        padding: 10px 12px; font-size: 14px; background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.2);
    }

    .promedio {
        text-align: center; font-size: 1.5rem; font-weight: 700; margin: 20px 0; padding: 15px;
        background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(255, 0, 255, 0.1) 100%);
        border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .promedio.excelente { color: #00ff88; }
    .promedio.bueno { color: #00d4ff; }
    .promedio.regular { color: #ffaa00; }
    .promedio.deficiente { color: #ff4444; }

    .result-card {
        background: rgba(255,255,255,0.08); border-radius: 15px; padding: 25px; margin: 20px 0;
        border-left: 4px solid #00d4ff; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .result-info { font-size: 1.1rem; line-height: 1.8; margin-bottom: 20px; }
    .result-info strong { color: #00d4ff; font-weight: 600; }

    .btn-group { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 20px; }

    .notification {
        position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 12px;
        color: white; font-weight: 600; z-index: 1000; transform: translateX(400px);
        transition: transform 0.3s ease;
    }
    .notification.success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .notification.error { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); }
    .notification.show { transform: translateX(0); }

    @media (max-width: 768px) {
        h1 { font-size: 2.5rem; }
        .glass-card { padding: 20px; margin: 10px 0; }
        .search-section { flex-direction: column; }
        .form-row { flex-direction: column; }
        .calificaciones-container { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); }
    }
</style>
</head>
<body>

<div class="container">
    <h1>Registro de Calificaciones</h1>

    <!-- Buscador -->
    <div id="searchSection" class="glass-card">
        <div class="search-section">
            <div class="search-input">
                <input type="text" id="searchName" placeholder="Buscar estudiante por nombre..." maxlength="60">
            </div>
            <button class="btn-primary" onclick="buscar()">Buscar</button>
            <button class="btn-success" onclick="nuevoRegistro()">Nuevo Registro</button>
            <button class="btn-delete" onclick="eliminarTodo()">Eliminar todo</button>
        </div>
    </div>

    <!-- Formulario -->
    <div id="formSection" class="glass-card hidden">
        <h2 style="text-align: center; margin-bottom: 25px; color: #00d4ff; font-weight: 600;">
            <span id="formTitle">Nuevo Registro</span>
        </h2>
        
        <div class="form-grid">
            <div class="form-row">
                <input type="text" id="nombre" maxlength="60" placeholder="Nombre completo del estudiante">
            </div>
            <div class="form-row">
                <input type="text" id="asignatura" maxlength="60" placeholder="Nombre de la asignatura">
            </div>
            <div class="form-row">
                <input type="number" id="numCalificaciones" min="1" max="10" placeholder="N√∫mero de calificaciones (1-10)" onchange="generarCampos()">
                <button class="btn-ghost" onclick="agregarNota()" type="button">Agregar nota</button>
                <button class="btn-ghost" onclick="limpiarNotas()" type="button">Limpiar notas</button>
            </div>
        </div>
        
        <div id="calificacionesContainer" class="calificaciones-container"></div>
        <div id="promedio" class="promedio"></div>
        
        <div class="btn-group">
            <button class="btn-success" onclick="guardar()">Guardar Registro</button>
            <button class="btn-primary" onclick="cancelar()">Cancelar</button>
        </div>
    </div>

    <!-- Vista de resultados -->
    <div id="resultSection" class="glass-card hidden">
        <div class="result-card">
            <div id="resultData" class="result-info"></div>
        </div>
        
        <div class="btn-group">
            <button class="btn-edit" onclick="editar()">Editar Registro</button>
            <button class="btn-delete" onclick="eliminarRegistro()">Eliminar Registro</button>
            <button class="btn-primary" onclick="volverBusqueda()">Nueva B√∫squeda</button>
        </div>
    </div>
</div>

<script>
let registros = JSON.parse(localStorage.getItem('registros') || '{}');
let registroActual = null;

function showNotification(message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(() => notification.classList.add('show'), 100);
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => document.body.removeChild(notification), 300);
    }, 3000);
}

function guardarRegistros() {
    localStorage.setItem('registros', JSON.stringify(registros));
}

function nuevoRegistro() {
    document.getElementById('searchSection').classList.add('hidden');
    document.getElementById('formSection').classList.remove('hidden');
    document.getElementById('resultSection').classList.add('hidden');
    document.getElementById('formTitle').textContent = 'Nuevo Registro';
    limpiarFormulario();
}

function limpiarFormulario() {
    document.getElementById('nombre').value = '';
    document.getElementById('asignatura').value = '';
    document.getElementById('numCalificaciones').value = '';
    document.getElementById('calificacionesContainer').innerHTML = '';
    document.getElementById('promedio').innerHTML = '';
    document.getElementById('promedio').className = 'promedio';
    registroActual = null;
}

function agregarNota(valor = '') {
    const container = document.getElementById('calificacionesContainer');
    const idx = container.children.length;

    const item = document.createElement('div');
    item.className = 'nota-item';

    const input = document.createElement('input');
    input.type = 'number'; input.min = 1; input.max = 7; input.step = 0.1;
    input.placeholder = `Nota ${idx + 1}`;
    input.value = valor;
    input.oninput = () => { validarBorde(input); calcularPromedio(); };

    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'btn-delete';
    btn.textContent = 'Eliminar';
    btn.onclick = () => { item.remove(); renumerarNotas(); calcularPromedio(); };

    item.appendChild(input);
    item.appendChild(btn);
    container.appendChild(item);
}

function limpiarNotas() {
    document.getElementById('calificacionesContainer').innerHTML = '';
    document.getElementById('numCalificaciones').value = '';
    calcularPromedio();
}

function generarCampos() {
    const num = parseInt(document.getElementById('numCalificaciones').value) || 0;
    const container = document.getElementById('calificacionesContainer');
    container.innerHTML = '';
    if (num > 0) {
        for (let i = 0; i < num; i++) agregarNota('');
    }
    calcularPromedio();
}

function renumerarNotas() {
    const items = document.querySelectorAll('.nota-item input');
    items.forEach((input, i) => input.placeholder = `Nota ${i + 1}`);
}

function validarBorde(input) {
    const value = parseFloat(input.value);
    if (input.value && (isNaN(value) || value < 1 || value > 7)) {
        input.style.borderColor = '#ff4444';
    } else {
        input.style.borderColor = 'rgba(0, 212, 255, 0.2)';
    }
}

function leerNotas() {
    const notas = [...document.querySelectorAll('.nota-item input')]
        .map(i => i.value.trim())
        .filter(v => v !== '')
        .map(v => parseFloat(v))
        .filter(n => !isNaN(n));
    return notas;
}

function calcularPromedio() {
    const notas = leerNotas();
    const promedioElement = document.getElementById('promedio');
    if (notas.length > 0) {
        const promedio = (notas.reduce((a,b) => a+b, 0) / notas.length);
        const promedioText = promedio.toFixed(2);
        let clase = '', emoji = '';
        if (promedio >= 6.0) { clase = 'excelente'; emoji = 'üåü'; }
        else if (promedio >= 5.0) { clase = 'bueno'; emoji = 'üëç'; }
        else if (promedio >= 4.0) { clase = 'regular'; emoji = '‚ö†Ô∏è'; }
        else { clase = 'deficiente'; emoji = '‚ùå'; }
        promedioElement.innerHTML = `${emoji} Promedio: ${promedioText}`;
        promedioElement.className = `promedio ${clase}`;
    } else {
        promedioElement.innerHTML = '';
        promedioElement.className = 'promedio';
    }
}

function guardar() {
    const nombre = document.getElementById('nombre').value.trim();
    const asignatura = document.getElementById('asignatura').value.trim();
    const notas = leerNotas();

    if (!nombre || !asignatura) {
        showNotification('Por favor, completa el nombre y la asignatura', 'error');
        return;
    }
    if (notas.length === 0) {
        showNotification('Ingresa al menos una calificaci√≥n', 'error');
        return;
    }
    const notasValidas = notas.every(n => n >= 1 && n <= 7);
    if (!notasValidas) {
        showNotification('Todas las notas deben estar entre 1.0 y 7.0', 'error');
        return;
    }

    // Si est√° en modo edici√≥n y cambia el nombre, elimina la clave anterior
    if (registroActual && registroActual !== nombre) {
        if (registros[nombre]) {
            const ok = confirm(`Ya existe un registro para "${nombre}". ¬øDeseas sobrescribirlo?`);
            if (!ok) return;
        }
        delete registros[registroActual];
    } else if (!registroActual && registros[nombre]) {
        const ok = confirm(`Ya existe un registro para "${nombre}". ¬øDeseas sobrescribirlo?`);
        if (!ok) return;
    }

    registros[nombre] = { asignatura, notas: notas.map(n => n.toFixed(1)) };
    guardarRegistros();

    showNotification(`Registro guardado exitosamente para ${nombre}`, 'success');

    document.getElementById('formSection').classList.add('hidden');
    document.getElementById('searchSection').classList.remove('hidden');
    document.getElementById('searchName').value = '';
    registroActual = null;
}

function buscar() {
    const nombre = document.getElementById('searchName').value.trim();
    if (!nombre) {
        showNotification('Ingresa un nombre para buscar', 'error');
        return;
    }
    if (registros[nombre]) {
        registroActual = nombre;
        const { asignatura, notas } = registros[nombre];
        const notasNumericas = notas.map(n => parseFloat(n)).filter(n => !isNaN(n));
        const promedio = notasNumericas.length > 0 ?
            (notasNumericas.reduce((a,b) => a+b, 0) / notasNumericas.length).toFixed(2) : 'N/A';
        document.getElementById('resultData').innerHTML = `
            <div style="margin-bottom: 15px;"><strong>üë§ Estudiante:</strong> ${nombre}</div>
            <div style="margin-bottom: 15px;"><strong>üìö Asignatura:</strong> ${asignatura}</div>
            <div style="margin-bottom: 15px;"><strong>üìù Calificaciones:</strong> ${notas.join(' ‚Ä¢ ')}</div>
            <div style="margin-bottom: 15px;"><strong>üìä Promedio:</strong> ${promedio}</div>
            <div><strong>üìà Total de notas:</strong> ${notas.length}</div>
        `;
        document.getElementById('searchSection').classList.add('hidden');
        document.getElementById('resultSection').classList.remove('hidden');
        showNotification(`Registro encontrado: ${nombre}`, 'success');
    } else {
        showNotification(`No se encontr√≥ un registro para "${nombre}"`, 'error');
    }
}

function editar() {
    if (!registroActual) return;
    const { asignatura, notas } = registros[registroActual];

    document.getElementById('formTitle').textContent = `Editando: ${registroActual}`;
    document.getElementById('nombre').value = registroActual;
    document.getElementById('asignatura').value = asignatura;
    document.getElementById('numCalificaciones').value = notas.length;

    const container = document.getElementById('calificacionesContainer');
    container.innerHTML = '';
    notas.forEach(n => agregarNota(n));

    calcularPromedio();

    document.getElementById('resultSection').classList.add('hidden');
    document.getElementById('formSection').classList.remove('hidden');
}

function eliminarRegistro() {
    if (!registroActual) return;
    const ok = confirm(`¬øEliminar el registro de "${registroActual}"? Esta acci√≥n no se puede deshacer.`);
    if (!ok) return;

    delete registros[registroActual];
    guardarRegistros();
    showNotification(`Registro eliminado: ${registroActual}`, 'success');

    registroActual = null;
    document.getElementById('resultSection').classList.add('hidden');
    document.getElementById('searchSection').classList.remove('hidden');
    document.getElementById('searchName').value = '';
}

function eliminarTodo() {
    const hayDatos = Object.keys(registros).length > 0;
    if (!hayDatos) {
        showNotification('No hay registros para eliminar', 'error');
        return;
    }
    const ok = confirm('¬øEliminar TODOS los registros? Esta acci√≥n no se puede deshacer.');
    if (!ok) return;

    registros = {};
    guardarRegistros();
    showNotification('Todos los registros fueron eliminados', 'success');

    // Reset de UI si estaba en otra vista
    registroActual = null;
    document.getElementById('formSection').classList.add('hidden');
    document.getElementById('resultSection').classList.add('hidden');
    document.getElementById('searchSection').classList.remove('hidden');
    document.getElementById('searchName').value = '';
    limpiarFormulario();
}

function volverBusqueda() {
    document.getElementById('resultSection').classList.add('hidden');
    document.getElementById('searchSection').classList.remove('hidden');
    document.getElementById('searchName').value = '';
    registroActual = null;
}

function cancelar() {
    document.getElementById('formSection').classList.add('hidden');
    document.getElementById('searchSection').classList.remove('hidden');
    limpiarFormulario();
}

// Permitir b√∫squeda con Enter
document.getElementById('searchName').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') buscar();
});

// Validaci√≥n visual en inputs de notas (delegada)
document.addEventListener('input', function(e) {
    if (e.target.closest('.nota-item') && e.target.tagName === 'INPUT') {
        validarBorde(e.target);
    }
});
</script>

</body>
</html>
